<%- include("../layouts/admin/header.ejs") -%>

    <body>
        <%- include('../partials/sidenav.ejs') -%>

            <main class="main-wrap">
                <header class="main-header navbar">
                    <div class="col-search">
                        <form class="searchform">
                            <div class="input-group">
                                <input list="search_terms" type="text" class="form-control" placeholder="Search term" />
                                <button class="btn btn-light bg" type="button"><i
                                        class="material-icons md-search"></i></button>
                            </div>
                            <datalist id="search_terms">
                                <option value="Products"></option>
                                <option value="New orders"></option>
                                <option value="Apple iphone"></option>
                                <option value="Ahmed Hassan"></option>
                            </datalist>
                        </form>
                    </div>
                    <div class="col-nav">
                        <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"><i
                                class="material-icons md-apps"></i></button>
                        <ul class="nav">
                            <li class="nav-item">
                                <a class="nav-link btn-icon" href="#">
                                    <i class="material-icons md-notifications animation-shake"></i>
                                    <span class="badge rounded-pill">3</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link btn-icon darkmode" href="#"> <i
                                        class="material-icons md-nights_stay"></i> </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="requestfullscreen nav-link btn-icon"><i
                                        class="material-icons md-cast"></i></a>
                            </li>
                            <li class="dropdown nav-item">
                                <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownLanguage"
                                    aria-expanded="false"><i class="material-icons md-public"></i></a>
                                <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownLanguage">
                                    <a class="dropdown-item text-brand" href="#"><img src="/imgs/theme/flag-us.png"
                                            alt="English" />English</a>
                                    <a class="dropdown-item" href="#"><img src="/imgs/theme/flag-fr.png"
                                            alt="Français" />Français</a>
                                    <a class="dropdown-item" href="#"><img src="/imgs/theme/flag-jp.png"
                                            alt="Français" />日本語</a>
                                    <a class="dropdown-item" href="#"><img src="/imgs/theme/flag-cn.png"
                                            alt="Français" />中国人</a>
                                </div>
                            </li>
                            <li class="dropdown nav-item">
                                <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount"
                                    aria-expanded="false"> <img class="img-xs rounded-circle"
                                        src="/imgs/people/avatar-2.png" alt="User" /></a>
                                <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                                    <a class="dropdown-item" href="#"><i
                                            class="material-icons md-perm_identity"></i>Edit Profile</a>
                                    <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Account
                                        Settings</a>
                                    <a class="dropdown-item" href="#"><i
                                            class="material-icons md-account_balance_wallet"></i>Wallet</a>
                                    <a class="dropdown-item" href="#"><i
                                            class="material-icons md-receipt"></i>Billing</a>
                                    <a class="dropdown-item" href="#"><i class="material-icons md-help_outline"></i>Help
                                        center</a>
                                    <div class="dropdown-divider"></div>
                                    <a class="dropdown-item text-danger" href="/admin/Logout"><i
                                            class="material-icons md-exit_to_app"></i>Logout</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </header>
                <section class="content-main">
                    <div class="content-header">
                        <div>
                            <h2 class="content-title card-title">Dashboard</h2>
                            <p>Whole data about your business here</p>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-lg-3">
                            <div class="card card-body mb-4">
                                <article class="icontext">
                                    <span class="icon icon-sm rounded-circle bg-primary-light"><i
                                            class="text-primary material-icons md-monetization_on"></i></span>
                                    <div class="text">
                                        <h6 class="mb-1 card-title">Revenue</h6>
                                        <span>₹<%= totalRevenue %></span>
                                        <span class="text-sm"> Shipping fees are not included </span>
                                    </div>
                                </article>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card card-body mb-4">
                                <article class="icontext">
                                    <span class="icon icon-sm rounded-circle bg-success-light"><i
                                            class="text-success material-icons md-local_shipping"></i></span>
                                    <div class="text">
                                        <h6 class="mb-1 card-title">Orders</h6>
                                        <span>
                                            <%= orderCount %>
                                        </span>
                                        <span class="text-sm"> Excluding orders in transit </span>
                                    </div>
                                </article>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card card-body mb-4">
                                <article class="icontext">
                                    <span class="icon icon-sm rounded-circle bg-warning-light"><i
                                            class="text-warning material-icons md-qr_code"></i></span>
                                    <div class="text">
                                        <h6 class="mb-1 card-title">Products</h6>
                                        <span>
                                            <%= productCount %>
                                        </span>
                                        <span class="text-sm"> In <%= categoryCount %> Categories </span>
                                    </div>
                                </article>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card card-body mb-4">
                                <article class="icontext">
                                    <span class="icon icon-sm rounded-circle bg-info-light"><i
                                            class="text-info material-icons md-shopping_basket"></i></span>
                                    <div class="text">
                                        <h6 class="mb-1 card-title">Monthly Earning</h6>
                                        <span>₹<%= monthlyRevenue %></span>
                                        <span class="text-sm"> Based in your local time. </span>
                                    </div>
                                </article>
                            </div>
                        </div>
                    </div>



                    <div class="row">
                        <div class="col-lg-3">
                            <div class="card card-body mb-4">
                                <article class="icontext">
                                    <span class="icon icon-sm rounded-circle bg-primary-light"><i
                                            class="fa-solid fa-user"></i></span>
                                    <div class="text">
                                        <h6 class="mb-1 card-title">Users</h6>
                                        <span>
                                            <%= users %>
                                        </span>
                                        <span class="text-sm">No of users </span>
                                    </div>
                                </article>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card card-body mb-4">
                                <article class="icontext">
                                    <span class="icon icon-sm rounded-circle bg-success-light">
                                        <i class="text-success material-icons md-local_shipping"></i>
                                    </span>
                                    <div class="text">
                                        <h6 class="mb-1 card-title">COD</h6>
                                        <span>
                                            <%= COD %>
                                        </span>
                                        <span class="text-sm">Cash on delivery count </span>
                                    </div>
                                </article>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card card-body mb-4">
                                <article class="icontext">
                                    <span class="icon icon-sm rounded-circle bg-warning-light">
                                        <i class="fas fa-money-check"></i>
                                    </span>
                                    <div class="text">
                                        <h6 class="mb-1 card-title">Razorpay</h6>
                                        <span>
                                            <%= razorpay %>
                                        </span>
                                        <span class="text-sm"> Razorpay count</span>
                                    </div>
                                </article>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card card-body mb-4">
                                <article class="icontext">
                                    <span class="icon icon-sm rounded-circle bg-info-light"><i
                                            class="fa-solid fa-wallet"></i></span>
                                    <div class="text">
                                        <h6 class="mb-1 card-title">Wallet</h6>
                                        <span><%= wallet %></span>
                                        <span class="text-sm"> Wallet payment count </span>
                                    </div>
                                </article>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-6 col-lg-12">

                            <div style="width: 50%;">
                                <canvas id="orderStatusPieChart"></canvas>
                            </div>
                        </div>
                        <div class="col-xl-6 col-lg-12">
                            <div style="width: 100%; height: 100%;">
                                <canvas id="dailySalesBarChart"></canvas>
                            </div>
                        </div>
                        <!-- monthyly sales report -->
                        <div style="font-family: 'Arial', sans-serif; margin: 0; padding: 0; background-color: #f4f4f4">
                            <div
                                style="max-width: 800px; margin: 50px auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
                                <h1 style="text-align: center;">Monthly Sales</h1>
                                <canvas id="monthlySalesChart" style="height: 300px;"></canvas>
                            </div>
                        </div>
                        <!-- monthyly sales report -->
                        <div class="card mb-4">
                            <header class="card-header">
                                <h4 class="card-title">Latest orders</h4>
                            </header>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <div class="table-responsive">
                                        <table class="table align-middle table-nowrap mb-0">
                                            <thead class="table-light">
                                                <tr>
                                                    <th class="align-middle" scope="col">Order ID</th>
                                                    <th class="align-middle" scope="col">Billing Name</th>
                                                    <th class="align-middle" scope="col">Date</th>
                                                    <th class="align-middle" scope="col">Total</th>
                                                    <th class="align-middle" scope="col">Payment Method</th>
                                                </tr>
                                            </thead>
                                            <% latestOrders.forEach((order)=>{ %>
                                                <tbody>
                                                    <tr>

                                                        <td><a href="#" class="fw-bold">
                                                                <%= order._id %>
                                                            </a></td>
                                                        <td>
                                                            <%= order.userId.name %>
                                                        </td>
                                                        <% const formattedDate=order.date.toLocaleString('en-US', {
                                                            weekday: 'short' , month: 'short' , day: 'numeric' ,
                                                            year: 'numeric' }); %>
                                                            <td>
                                                                <%= formattedDate %>
                                                            </td>
                                                            <td>
                                                                <%= order.totalAmount %>
                                                            </td>
                                                            <td><i
                                                                    class="material-icons md-payment font-xxl text-muted mr-5"></i>
                                                                <%= order.paymentMethod %>
                                                            </td>

                                                    </tr>
                                                    <% }) %>
                                                </tbody>
                                        </table>
                                    </div>
                                </div>
                                <!-- table-responsive end// -->
                            </div>
                        </div>
                        <div class="pagination-area mt-15 mb-10">
                            <nav aria-label="Page navigation example">
                                <ul class="pagination">
                                    <li class="page-item">
                                        <a class="page-link" href="/admin/dashboard?id=<%= previous %>"><</a>
                                    </li>
                                    <% for(let i=1; i <=totalPages;i++){ %>
                                        <li class="page-item">
                                            <a class="page-link" href="/admin/dashboard?id=<%= i %>">
                                                <%=i %>
                                            </a>
                                        </li>
                                        <%}%>
                                            <li class="page-item">
                                                <a class="page-link" href="/admin/dashboard?id=<%= next %>">></a>
                                            </li>
                                </ul>
                            </nav>
                        </div>
                </section>



                <section class="content-main">
                    <div class="card mb-4">
                        <header class="card-header">
                            <div class="container-fluid">
                                <div class="row align-items-center">
                                    <div class="col-lg-12">
                                        <h4 class="card-title">Latest Orders</h4>
                                    </div>
                                    <div>
                                        <form action="/admin/createReport" method="post" id="filterForm">
                                            <div class="row align-items-center">
                                                <label for="startDate" class="col-md-4 col-12">Start Date:</label>
                                                <input type="date" required id="startDate" name="startDate"
                                                    class="col-md-8 col-12 form-control mb-2">
                                            </div>

                                            <div class="row align-items-center">
                                                <label for="endDate" class="col-md-4 col-12">End Date:</label>
                                                <input type="date" required id="endDate" name="endDate"
                                                    class="col-md-8 col-12 form-control mb-2">
                                            </div>

                                            <button type="submit" class="btn btn-primary">Generate Report</button>
                                        </form>
                                    </div>

                                </div>
                            </div>
                        </header>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table align-middle table-nowrap mb-0">
                                    <thead class="table-light">

                                </table>
                            </div>
                        </div>


                    </div>
                </section>



                <div id="dummy" data-delivered="<%= delivered %>"></div>
                <div id="dum" data-cancelled="<%= cancelled %>"></div>
                <div id="dumm" data-placed="<%= placed %>"></div>
                <div id="du" data-returns="<%= returns %>"></div>


                <input type="hidden" id="jan" value="<%= updatedMonthlyValue[0].total %>">
                <input type="hidden" id="feb" value="<%= updatedMonthlyValue[1].total %>">
                <input type="hidden" id="mar" value="<%= updatedMonthlyValue[2].total %>">
                <input type="hidden" id="apr" value="<%= updatedMonthlyValue[3].total %>">
                <input type="hidden" id="may" value="<%= updatedMonthlyValue[4].total %>">
                <input type="hidden" id="jun" value="<%= updatedMonthlyValue[5].total %>">
                <input type="hidden" id="jul" value="<%= updatedMonthlyValue[6].total %>">
                <input type="hidden" id="aug" value="<%= updatedMonthlyValue[7].total %>">
                <input type="hidden" id="sep" value="<%= updatedMonthlyValue[8].total %>">
                <input type="hidden" id="oct" value="<%= updatedMonthlyValue[9].total %>">
                <input type="hidden" id="nov" value="<%= updatedMonthlyValue[10].total %>">
                <input type="hidden" id="dec" value="<%= updatedMonthlyValue[11].total %>">




                <input type="hidden" id="day1" value="<%= mergedData[0].total %>">
                <input type="hidden" id="day2" value="<%= mergedData[1].total %>">
                <input type="hidden" id="day3" value="<%= mergedData[2].total %>">
                <input type="hidden" id="day4" value="<%= mergedData[3].total %>">
                <input type="hidden" id="day5" value="<%= mergedData[4].total %>">
                <input type="hidden" id="day6" value="<%= mergedData[5].total %>">
                <input type="hidden" id="day7" value="<%= mergedData[6].total %>">
                <input type="hidden" id="day8" value="<%= mergedData[7].total %>">
                <input type="hidden" id="day9" value="<%= mergedData[8].total %>">
                <input type="hidden" id="day10" value="<%= mergedData[9].total %>">
                <input type="hidden" id="day11" value="<%= mergedData[10].total %>">
                <input type="hidden" id="day12" value="<%= mergedData[11].total %>">
                <input type="hidden" id="day13" value="<%= mergedData[12].total %>">
                <input type="hidden" id="day14" value="<%= mergedData[13].total %>">
                <input type="hidden" id="day15" value="<%= mergedData[14].total %>">


                <!-- content-main end// -->
                <footer class="main-footer font-xs">
                    <div class="row pb-30 pt-15">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear());
                            </script>
                            &copy; Nest - HTML Ecommerce Template .
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end">All rights reserved</div>
                        </div>
                    </div>
                </footer>
            </main>
            <script src="/js/vendors/jquery-3.6.0.min.js"></script>
            <script src="/js/vendors/bootstrap.bundle.min.js"></script>
            <script src="/js/vendors/select2.min.js"></script>
            <script src="/js/vendors/perfect-scrollbar.js"></script>
            <script src="/js/vendors/jquery.fullscreen.min.js"></script>
            <script src="/js/vendors/chart.js"></script>
            <!-- Main Script -->
            <script src="/js/main.js?v=1.1" type="text/javascript"></script>
            <script src="/js/custom-chart.js" type="text/javascript"></script>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


            <script>
                document.addEventListener('DOMContentLoaded', function () {

                    let jan = document.getElementById('jan').value
                    let feb = document.getElementById('feb').value
                    let mar = document.getElementById('mar').value
                    let apr = document.getElementById('apr').value
                    let may = document.getElementById('may').value
                    let jun = document.getElementById('jun').value
                    let jul = document.getElementById('jul').value
                    let aug = document.getElementById('aug').value
                    let sep = document.getElementById('sep').value
                    let oct = document.getElementById('oct').value
                    let nov = document.getElementById('nov').value
                    let dec = document.getElementById('dec').value
                    // Sample data for monthly sales
                    const monthlySalesData = [jan, feb];

                    // Create a bar chart using Chart.js library
                    const ctx = document.getElementById('monthlySalesChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: getMonthLabels(),
                            datasets: [{
                                label: 'Monthly Sales',
                                backgroundColor: 'rgba(44, 120, 220, 0.8)',
                                borderColor: 'rgba(44, 120, 220, 1)',
                                data: monthlySalesData,
                            }]
                        },
                        options: {
                            scales: {
                                x: {
                                    grid: {
                                        display: false
                                    }
                                },
                                y: {
                                    beginAtZero: true
                                }
                            },
                            responsive: false,
                            maintainAspectRatio: false,
                        }
                    });

                    // Example function to get labels for each month
                    function getMonthLabels() {
                        return ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    }
                });



            </script>
            <script>
                const delivered = document.getElementById('dummy').getAttribute('data-delivered')
                const cancelled = document.getElementById('dum').getAttribute('data-cancelled')
                const placed = document.getElementById('dumm').getAttribute('data-placed')
                const returns = document.getElementById('du').getAttribute('data-returns')
                const orderStatusData = {
                    cancelled: cancelled,
                    delivered: delivered,
                    placed: placed,
                    return: returns
                };

                // Create a pie chart using Chart.js library
                const ctx = document.getElementById('orderStatusPieChart').getContext('2d');
                new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(orderStatusData),
                        datasets: [{
                            data: Object.values(orderStatusData),
                            backgroundColor: ['#ff0000', '#36A2EB', '#4CAF50', '#FFCE56',],
                        }]
                    },
                    options: {
                        responsive: false,
                        maintainAspectRatio: false,
                    }
                });
            </script>

            <script>
                document.addEventListener('DOMContentLoaded', function () {


                    let day1 = document.getElementById('day1').value
                    let day2 = document.getElementById('day2').value
                    let day3 = document.getElementById('day3').value
                    let day4 = document.getElementById('day4').value
                    let day5 = document.getElementById('day5').value
                    let day6 = document.getElementById('day6').value
                    let day7 = document.getElementById('day7').value
                    let day8 = document.getElementById('day8').value
                    let day9 = document.getElementById('day9').value
                    let day10 = document.getElementById('day10').value
                    let day11 = document.getElementById('day11').value
                    let day12 = document.getElementById('day12').value
                    let day13 = document.getElementById('day13').value
                    let day14 = document.getElementById('day14').value
                    let day15 = document.getElementById('day15').value


                    // Sample data for daily sales (replace this with your actual data)
                    const dailySalesData = [day1, day2, day3, day4, day5, day6, day7, day8, day9, day10, day11, day12, day13, day14, day15];

                    // Create a bar chart using Chart.js library
                    const ctx = document.getElementById('dailySalesBarChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: getDayLabels(),
                            datasets: [{
                                label: 'Daily Sales',
                                backgroundColor: 'rgba(44, 120, 220, 0.8)',
                                borderColor: 'rgba(44, 120, 220, 1)',
                                borderWidth: 1,
                                data: dailySalesData,
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    grid: {
                                        display: false
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Sales'
                                    }
                                }
                            }
                        }
                    });

                    // Example function to get labels for each day
                    function getDayLabels() {
                        // You can customize the labels based on your needs
                        return ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7', 'Day 8', 'Day 9', 'Day 10', 'Day 11', 'Day 12', 'Day 13', 'Day 14', 'Day 15'];
                    }
                });
            </script>

    </body>
    <%- include("../layouts/admin/footer.ejs") -%>